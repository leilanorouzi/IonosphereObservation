
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>reference_transformation &#8212; EM wave propagation for antenna 0.0.2 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for reference_transformation</h1><div class="highlight"><pre>
<span></span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># import matplotlib.pyplot as plt</span>

<span class="c1"># from sympy import *</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">cmath</span>


<div class="viewcode-block" id="asCartesian"><a class="viewcode-back" href="../reference_transformation.html#reference_transformation.asCartesian">[docs]</a><span class="k">def</span> <span class="nf">asCartesian</span><span class="p">(</span><span class="n">rthetaphi</span><span class="p">):</span>
    <span class="c1"># takes list rthetaphi (single coord)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">rthetaphi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">rthetaphi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">rthetaphi</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">]</span></div>


<div class="viewcode-block" id="asSpherical"><a class="viewcode-back" href="../reference_transformation.html#reference_transformation.asSpherical">[docs]</a><span class="k">def</span> <span class="nf">asSpherical</span><span class="p">(</span><span class="n">xyz</span><span class="p">):</span>
    <span class="c1"># print(&#39;asSpherical\n:&#39;,np.shape(xyz))</span>
    <span class="c1"># takes list xyz (single coord)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">xyz</span><span class="p">))</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>
    <span class="c1"># phi     =  np.arctan2(y,x)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">cmath</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">phi</span><span class="p">]</span></div>


<div class="viewcode-block" id="rotate_vec"><a class="viewcode-back" href="../reference_transformation.html#reference_transformation.rotate_vec">[docs]</a><span class="k">def</span> <span class="nf">rotate_vec</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">ref_p</span> <span class="o">=</span> <span class="n">asSpherical</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="c1"># print(a)</span>
    <span class="c1"># print(ref_p)</span>
    <span class="c1"># print(type(ref_p[2]))</span>
    <span class="c1"># print([i * 180 / np.pi for i in ref_p[1:]])</span>
    <span class="c1">#</span>
    <span class="c1"># print(b)</span>
    <span class="n">vec_p</span> <span class="o">=</span> <span class="n">asSpherical</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="c1"># print(vec_p)</span>
    <span class="c1"># print([i * 180 / np.pi for i in vec_p[1:]])</span>

    <span class="n">rotated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">ref_p</span><span class="p">,</span> <span class="n">vec_p</span><span class="p">)</span>
    <span class="c1"># rotated[1] = theta: the angel from z</span>
    <span class="c1"># rotate[2] = phi: the angel form x</span>
    <span class="c1"># print(&#39;rotated:&#39;,rotated)</span>
    <span class="c1"># rotated = np.subtract(vec_p,ref_p)</span>
    <span class="c1"># rotated[0] = vec_p[0]</span>
    <span class="n">vec_rot</span> <span class="o">=</span> <span class="n">asCartesian</span><span class="p">(</span><span class="n">rotated</span><span class="p">)</span>
    <span class="c1"># print(&#39;vec_rot&#39;,vec_rot)</span>

    <span class="k">return</span> <span class="n">vec_rot</span><span class="p">,</span> <span class="n">rotated</span></div>


<div class="viewcode-block" id="vectors_angel"><a class="viewcode-back" href="../reference_transformation.html#reference_transformation.vectors_angel">[docs]</a><span class="k">def</span> <span class="nf">vectors_angel</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">cmath</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">))))</span></div>


<div class="viewcode-block" id="projection"><a class="viewcode-back" href="../reference_transformation.html#reference_transformation.projection">[docs]</a><span class="k">def</span> <span class="nf">projection</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># a: the main vector, the vector that other vectors will be added to</span>
    <span class="c1"># b: The second vector that will be added to the original vector</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">vectors_angel</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">vec_perp</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
    <span class="n">vec_para</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">cmath</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">vec_para</span><span class="p">,</span> <span class="n">vec_perp</span></div>


<div class="viewcode-block" id="axis_angels"><a class="viewcode-back" href="../reference_transformation.html#reference_transformation.axis_angels">[docs]</a><span class="k">def</span> <span class="nf">axis_angels</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function calculates the angels between the vector and x, y  and z axis.</span>

<span class="sd">    :param vec: the vector that second frame is attached to</span>
<span class="sd">    :type vec: list</span>
<span class="sd">    :return: 3 angles in rad.</span>
<span class="sd">    :rtype: float, float, float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># l = vector_length(vec)</span>
    <span class="c1"># ang_x = np.arccos(vec[0]/l)</span>
    <span class="n">ang_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ang_x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># ang_y = np.arccos(vec[1]/l)</span>
    <span class="n">ang_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ang_y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># ang_z = np.arccos(vec[2]/l)</span>
    <span class="n">ang_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ang_z</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">ang_x</span><span class="p">,</span> <span class="n">ang_y</span><span class="p">,</span> <span class="n">ang_z</span></div>


<div class="viewcode-block" id="rotate_refernce"><a class="viewcode-back" href="../reference_transformation.html#reference_transformation.rotate_refernce">[docs]</a><span class="k">def</span> <span class="nf">rotate_refernce</span><span class="p">(</span><span class="n">vec</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    :param vec: the vector that second frame is attached to</span>
<span class="sd">    :type vec: list</span>
<span class="sd">    :return: The reference frame rotation matrix.</span>
<span class="sd">    :rtype: np.array</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">angx</span><span class="p">,</span> <span class="n">angy</span><span class="p">,</span> <span class="n">angz</span> <span class="o">=</span> <span class="n">axis_angels</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>

    <span class="n">angx</span> <span class="o">=</span> <span class="n">angx</span>
    <span class="n">angy</span> <span class="o">=</span> <span class="n">angy</span>
    <span class="n">angz</span> <span class="o">=</span> <span class="n">angz</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Angles:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">axis_angels</span><span class="p">(</span><span class="n">vec</span><span class="p">)])</span>
    <span class="n">rot_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angx</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angx</span><span class="p">)],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angx</span><span class="p">)]</span>
    <span class="p">])</span>
    <span class="n">rot_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angy</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angy</span><span class="p">)],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angy</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angy</span><span class="p">)]</span>
    <span class="p">])</span>
    <span class="n">rot_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angz</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angz</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angz</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angz</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">])</span>

    <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rot_x</span><span class="p">,</span> <span class="n">rot_y</span><span class="p">),</span> <span class="n">rot_z</span><span class="p">)</span>
    <span class="c1"># rot = np.dot(rot_x,rot_y)</span>
    <span class="k">return</span> <span class="n">rot</span></div>

<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># # vec_ref = np.array([4950.0, 9950.0, 20000.0])*1</span>
<span class="c1"># x = 20000</span>
<span class="c1"># # vec_ref = np.array([x,x*np.tan(np.deg2rad(45)),x*np.tan(np.deg2rad(30))])*1</span>
<span class="c1"># vec_ref = np.array([x,x,x*np.tan(np.deg2rad(30))])*-1</span>
<span class="c1"># vec = [0,0,15000]</span>
<span class="c1">#</span>
<span class="c1"># vec_rot, ang = np.array(rotate_vec(vec_ref,vec), dtype=float)</span>
<span class="c1"># # vec_rot = rotate_vec(vec,vec_ref)</span>
<span class="c1">#</span>
<span class="c1"># vec_rot2,ang2 = rotate_vec(vec_ref,vec_rot)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># #</span>
<span class="c1"># # # print(&#39;ROTATED\n&#39;,vec_rot)</span>
<span class="c1"># #</span>
<span class="c1"># # ----------------------------------------------------------</span>
<span class="c1"># # Visulization</span>
<span class="c1"># # Coordinates of the antenna and the source locations</span>
<span class="c1">#</span>
<span class="c1"># # Plotting in 3 dimensions</span>
<span class="c1"># fig = plt.figure(figsize=(10, 10))</span>
<span class="c1"># fig.suptitle(&#39;Please close the picture, when you finished&#39;, fontsize=20, color=&#39;brown&#39;)</span>
<span class="c1"># ax = plt.axes(projection=&#39;3d&#39;)</span>
<span class="c1">#</span>
<span class="c1"># plt.title(&#39;The overview of the antenna and source coordinates\n\n&#39;, fontsize=14)</span>
<span class="c1"># ax.scatter3D( vec_ref[0],vec_ref[1],vec_ref[2],</span>
<span class="c1">#              color=&#39;g&#39;</span>
<span class="c1">#              )</span>
<span class="c1"># ax.plot(</span>
<span class="c1">#     [vec_ref[0], 0],</span>
<span class="c1">#     [vec_ref[1], 0],</span>
<span class="c1">#     [vec_ref[2], 0],</span>
<span class="c1">#     color=&#39;gold&#39;)</span>
<span class="c1">#</span>
<span class="c1"># ax.plot(</span>
<span class="c1">#     [vec[0], 0],</span>
<span class="c1">#     [vec[1], 0],</span>
<span class="c1">#     [vec[2]+10000, 0],</span>
<span class="c1">#     color=&#39;r&#39;)</span>
<span class="c1">#</span>
<span class="c1"># ax.plot(</span>
<span class="c1">#     [vec_rot[0], 0],</span>
<span class="c1">#     [vec_rot[1], 0],</span>
<span class="c1">#     [vec_rot[2], 0],</span>
<span class="c1">#     color=&#39;g&#39;)</span>
<span class="c1">#</span>
<span class="c1"># ax.plot(</span>
<span class="c1">#     [vec_rot2[0], 0],</span>
<span class="c1">#     [vec_rot2[1], 0],</span>
<span class="c1">#     [vec_rot2[2], 0],</span>
<span class="c1">#     color=&#39;b&#39;)</span>
<span class="c1">#</span>
<span class="c1"># ax.text(vec_ref[0] - 500, vec_ref[1], vec_ref[2] + 1000, &#39;The source\n&#39;, size=14, zorder=1,</span>
<span class="c1">#         color=&#39;r&#39;)</span>
<span class="c1"># ax.set_xlabel(&#39;X &#39;)</span>
<span class="c1"># ax.set_ylabel(&#39;Y &#39;)</span>
<span class="c1"># ax.set_zlabel(&#39;Z &#39;)</span>
<span class="c1"># plt.show()  # to keep the picture until you close it</span>
<span class="c1"># plt.close(fig)  # Free the memory</span>
<span class="c1">#</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">EM wave propagation for antenna</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../info.html">Project overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main.html">Main code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Module codes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Leila Norouzi.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>